import{j as M,e as c,k as f,l as o,d as I,f as S,r as K,A as h,v as R,h as a,g as d,w,aZ as oe,u as ne,q as ie,a as re,a3 as Z,W as ce,K as b,aR as F,c as D,a4 as de,I as ue,M as fe,aJ as j,t as P,y as A,aA as me,aY as he,x as ve,Q as V,aP as L,as as pe,a_ as ge}from"./index-62a62e6e.js";import{g as U}from"./globalStore-353b4b5d.js";import{s as _e,i as Ce,L as be,m as we,u as z,d as xe}from"./knowledgeBase-e21cae7f.js";import{_ as ye}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-f78418d8.js";import{d as ke}from"./dayjs-23c9994e.js";import{i as He,j as $e}from"./more-horizontal-44c34a82.js";import{_ as Ae}from"./Avatar.vue_vue_type_script_setup_true_lang-d4d1e36b.js";import{_ as De}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c8f73628.js";import{_ as Ve}from"./Dropdown.vue_vue_type_script_setup_true_lang-8f31c9b1.js";import{T as Le,_ as Se}from"./TextEditor.vue_vue_type_script_setup_true_lang-3540b034.js";import"./Link-2b0a1c2c.js";const Me={},Be={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ie(u,s){return c(),f("svg",Be,[...s[0]||(s[0]=[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.61375 0.873535C4.80096 0.873535 4.06901 1.36543 3.76196 2.11799L1.42904 7.8358C0.892289 9.15133 1.86001 10.5913 3.28083 10.5913H6.19537V13.1263C6.19537 14.2309 7.0908 15.1263 8.19537 15.1263H8.49555C8.86191 15.1263 9.19894 14.926 9.374 14.6042L12.4924 8.87124C12.5722 8.7246 12.614 8.56033 12.614 8.3934V2.87354C12.614 1.76897 11.7185 0.873535 10.614 0.873535H5.61375ZM14.721 1.50752C14.721 1.23138 14.4972 1.00752 14.221 1.00752C13.9449 1.00752 13.721 1.23138 13.721 1.50752V7.99239C13.721 8.26853 13.9449 8.49239 14.221 8.49239C14.4972 8.49239 14.721 8.26853 14.721 7.99239V1.50752Z",fill:"#171717"},null,-1)])])}const Te=M(Me,[["render",Ie]]),Ee={},Re={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ze(u,s){return c(),f("svg",Re,[...s[0]||(s[0]=[o("rect",{width:"16",height:"16",fill:"#FAFAFA"},null,-1),o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.19585 10.5913C7.19585 10.0391 6.74814 9.59135 6.19585 9.59135H3.28132C2.57091 9.59135 2.08705 8.87134 2.35542 8.21357L4.68834 2.49576C4.84187 2.11948 5.20785 1.87354 5.61424 1.87354H10.6145C11.1667 1.87354 11.6145 2.32125 11.6145 2.87354V8.3934L8.49604 14.1263H8.19585C7.64357 14.1263 7.19585 13.6786 7.19585 13.1263V10.5913ZM3.28132 10.5913H5.19585H6.19585V11.5913V13.1263C6.19585 14.2309 7.09128 15.1263 8.19585 15.1263H8.49604C8.8624 15.1263 9.19943 14.926 9.37449 14.6042L12.4929 8.87124C12.5727 8.7246 12.6145 8.56033 12.6145 8.3934V2.87354C12.6145 1.76897 11.719 0.873535 10.6145 0.873535H5.61424C4.80145 0.873535 4.0695 1.36543 3.76244 2.11799L1.42953 7.8358C0.892777 9.15133 1.8605 10.5913 3.28132 10.5913ZM14.7215 1.50752C14.7215 1.23138 14.4977 1.00752 14.2215 1.00752C13.9454 1.00752 13.7215 1.23138 13.7215 1.50752V7.99239C13.7215 8.26853 13.9454 8.49239 14.2215 8.49239C14.4977 8.49239 14.7215 8.26853 14.7215 7.99239V1.50752Z",fill:"#171717"},null,-1)])])}const Fe=M(Ee,[["render",Ze]]),je={},Pe={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ze(u,s){return c(),f("svg",Pe,[...s[0]||(s[0]=[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.3862 15.126C11.199 15.126 11.931 14.6341 12.238 13.8815L14.571 8.16372C15.1077 6.84818 14.14 5.40817 12.7192 5.40817H9.80463V2.87319C9.80463 1.76862 8.9092 0.873189 7.80463 0.873189H7.50445C7.13809 0.873189 6.80106 1.07353 6.626 1.39536L5.14803 4.11246L3.50758 7.12827C3.42781 7.27491 3.38603 7.43918 3.38603 7.60611V13.126C3.38603 14.2305 4.28146 15.126 5.38603 15.126H10.3862ZM1.27896 14.492C1.27896 14.7681 1.50282 14.992 1.77896 14.992C2.0551 14.992 2.27896 14.7681 2.27896 14.492V8.00712C2.27896 7.73098 2.0551 7.50712 1.77896 7.50712C1.50282 7.50712 1.27896 7.73098 1.27896 8.00712V14.492Z",fill:"#171717"},null,-1)])])}const Ke=M(je,[["render",ze]]),Ue={},qe={width:"14",height:"16",viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ne(u,s){return c(),f("svg",qe,[...s[0]||(s[0]=[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.80415 5.40817C7.80415 5.96045 8.25186 6.40817 8.80415 6.40817H11.7187C12.4291 6.40817 12.913 7.12817 12.6446 7.78594L10.3117 13.5038C10.1581 13.88 9.79215 14.126 9.38576 14.126H4.38554C3.83325 14.126 3.38554 13.6783 3.38554 13.126V7.60611L6.50396 1.87319H6.80415C7.35643 1.87319 7.80415 2.3209 7.80415 2.87319V5.40817ZM11.7187 5.40817H9.80415H8.80415V4.40817V2.87319C8.80415 1.76862 7.90872 0.873189 6.80415 0.873189H6.50396C6.1376 0.873189 5.80057 1.07353 5.62551 1.39536L2.50709 7.12827C2.42732 7.27491 2.38554 7.43918 2.38554 7.60611V13.126C2.38554 14.2305 3.28097 15.126 4.38554 15.126H9.38576C10.1985 15.126 10.9305 14.6341 11.2376 13.8815L13.5705 8.16372C14.1072 6.84818 13.1395 5.40817 11.7187 5.40817ZM0.27847 14.492C0.27847 14.7681 0.502328 14.992 0.77847 14.992C1.05461 14.992 1.27847 14.7681 1.27847 14.492V8.00712C1.27847 7.73098 1.05461 7.50712 0.77847 7.50712C0.502328 7.50712 0.27847 7.73098 0.27847 8.00712V14.492Z",fill:"#171717"},null,-1)])])}const We=M(Ue,[["render",Ne]]),Je=I({__name:"DiscardButton",props:{label:{default:"Discard"},hideDialog:{type:Boolean,default:!1},title:{default:"Discard?"},message:{default:"Are you sure you want to discard this?"}},emits:["discard"],setup(u,{emit:s}){const{$dialog:g}=U(),v=s;function p(){if(u.hideDialog){v("discard");return}g({title:u.title,message:u.message,onConfirm:({hideDialog:n})=>{n()},actions:[{label:"Confirm",variant:"solid",onClick(n){v("discard"),n()}}]})}return(n,x)=>{const r=K("Button");return c(),S(r,{label:n.label,onClick:p},null,8,["label"])}}}),Oe={class:"flex items-center justify-between mb-8 p-4 rounded-lg bg-gray-50"},Qe={class:"flex items-center gap-2"},Ye={class:"flex items-center gap-1"},Ge={class:"flex items-center justify-center gap-2"},Xe=I({__name:"ArticleFeedback",props:{feedback:{default:0},articleId:{}},setup(u){const s=u,g=h(s.feedback);function v(p){g.value=p,p!==s.feedback&&_e.submit({articleId:s.articleId,action:p})}return(p,n)=>{const x=K("router-link");return c(),f("div",Oe,[o("div",null,[o("div",Qe,[n[2]||(n[2]=o("span",{class:"text-gray-800 text-sm"},"Did this article solve your issue?",-1)),o("div",Ye,[(c(),S(R(g.value===1?a(Ke):a(We)),{class:"w-4 h-4 cursor-pointer",onClick:n[0]||(n[0]=r=>v(1))})),(c(),S(R(g.value===2?a(Te):a(Fe)),{class:"w-4 h-4 cursor-pointer",onClick:n[1]||(n[1]=r=>v(2))}))])])]),o("div",Ge,[n[4]||(n[4]=o("span",{class:"font-normal text-sm"}," Can’t find what you’re looking for? ",-1)),d(x,{to:{name:"TicketNew"}},{default:w(()=>[...n[3]||(n[3]=[o("p",{class:"underline font-base text-sm"},"Create a ticket →",-1)])]),_:1})])])}}}),et={class:"lucide lucide-dot",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function tt(u,s){return c(),f("svg",et,[...s[0]||(s[0]=[o("circle",{cx:"12.1",cy:"12.1",r:"1"},null,-1)])])}const at=oe({name:"lucide-dot",render:tt}),st={class:"flex gap-1 items-center crumbs truncate"},lt={key:0,class:"flex gap-2"},ot={key:0,class:"py-4 mx-auto w-full max-w-3xl px-5 flex flex-col"},nt={class:"flex flex-col gap-3"},it={class:"flex gap-1 items-center justify-between"},rt={class:"flex gap-1 items-center"},ct={class:"flex gap-1 items-center justify-center"},dt={class:"truncate capitalize text-base text-ink-gray-9 font-medium"},ut={class:"text-xs text-gray-500"},ft={key:1,class:"flex gap-2"},mt=["disabled"],ht={key:0,class:"p-4"},$t=I({__name:"Article",props:{articleId:{type:String,required:!0}},setup(u){const s=u,{$dialog:g}=U(),v=ne(),p=ie(),n=re(),x=h(null),r=h(p.query.isEdit??!1),y=h(""),_=h(""),T=h(),E=h(null);Z(()=>E.value,e=>{e&&e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+"px")});const l=ce({url:"helpdesk.api.knowledge_base.get_article",params:{name:s.articleId},auto:!0,onSuccess:e=>{y.value=e.content,_.value=e.title,T.value=e.feedback,b.value&&(F("article_viewed",{data:{user:n.userId,article:e.name,title:e.title}}),q(e.name))},onError:e=>{e.exc_type==="PermissionError"&&v.replace({name:"CustomerKnowledgeBase"})}});function q(e){Ce.submit({article:e},{onError:t=>{t.exc_type}})}const N=ge(()=>{var t;const e=((t=l.data)==null?void 0:t.status)==="Published"?"Draft":"Published";z.submit({doctype:"HD Article",name:l.data.name,fieldname:"status",value:e},{onSuccess:()=>{l.reload()}})},300),k=h(!1),H=h(!1);function W(e){we.submit({category:e,articles:[s.articleId]},{onSuccess:()=>{l.reload(),H.value=!1,V.success("Article moved")},onError:t=>{var m;let i=((m=t==null?void 0:t.messages)==null?void 0:m[0])||t.message;V.error(i),H.value=!1}})}function J(){r.value=!0,x.value.editor.chain().focus("start")}function O(){r.value=!1,k.value=!1,_.value=l.data.title,y.value=l.data.content}function Q(){r.value=!1,Y()}function Y(){k.value&&z.submit({doctype:"HD Article",name:l.data.name,fieldname:{content:y.value,title:_.value}},{onSuccess:()=>{F("article_updated",{data:{category:s.articleId}}),V.success("Article updated"),k.value=!1,l.reload()}})}function G(){g({title:"Delete Article",message:"Are you sure you want to delete this article?",actions:[{label:"Confirm",variant:"solid",onClick({close:e}){xe.submit({doctype:"HD Article",name:l.data.name},{onSuccess:()=>{V.success("Article deleted"),v.push({name:"AgentKnowledgeBase"})}}),e()}}]})}const X=D(()=>{var e,t;return(e=l.data)!=null&&e.content?ee((t=l.data)==null?void 0:t.content):null});function ee(e){const i=new DOMParser().parseFromString(e,"text/html");return i.querySelectorAll("h2, h3, h4, h5, h6").forEach(C=>{const $=C.textContent.trim().replace(/[^a-z0-9]+/gi,"-").toLowerCase();C.setAttribute("id",$)}),i.body.innerHTML}function te(){const e=window.location.hash;if(!e)return;const t=document.querySelector(e);if(!t)return;t.scrollIntoView({behavior:"smooth"}),t.classList.add("transition-all");const i=t.style.fontSize;setTimeout(()=>{t.style.fontSize="1.5rem",setTimeout(()=>{t.style.fontSize=i},500)},500)}Z([()=>y.value,()=>_.value],([e,t])=>{k.value=e!==l.data.content||t!==l.data.title});const ae=D(()=>["rounded-b-lg max-w-[unset] prose-sm",r.value&&"overflow-auto h-[calc(100vh-340px)] sm:h-[calc(100vh-250px)]"]),se=D(()=>[{label:"Edit",icon:"edit",onClick:()=>{J()}},{label:"Move To",icon:"corner-up-right",onClick:()=>H.value=!0},{label:"Share",icon:"link",onClick:()=>{const e=new URL(window.location.href);e.pathname=`/helpdesk/kb-public/articles/${s.articleId}`,de(e.toString(),"Article link copied to clipboard")}},{group:"Danger",hideLabel:!0,items:[{label:"Delete",component:ue(L,{label:"Delete",variant:"ghost",iconLeft:"trash-2",theme:"red",style:"width: 100%; justify-content: flex-start;",onClick:G})}]}]),le=D(()=>{var t,i,m,C,B;const e=[{label:"Knowledge Base",route:{name:b.value?"CustomerKnowledgeBase":"AgentKnowledgeBase"}}];if((t=l.data)!=null&&t.category_name){let $={label:(i=l.data)==null?void 0:i.category_name};b.value?$.route={name:"Articles",params:{categoryId:(m=l.data)==null?void 0:m.category_id}}:$.route={name:"AgentKnowledgeBase"},e.push($)}return(C=l.data)!=null&&C.title&&e.push({label:(B=l.data)==null?void 0:B.title,route:{name:"Article"}}),e});return fe(()=>{setTimeout(()=>{te()},100)}),(e,t)=>(c(),f("div",null,[d(be,null,j({"left-header":w(()=>[o("div",st,[d(a(De),{items:le.value,class:"-ml-0.5"},null,8,["items"])])]),_:2},[a(b)?void 0:{name:"right-header",fn:w(()=>{var i,m;return[r.value?A("",!0):(c(),f("div",lt,[d(a(L),{label:((i=a(l).data)==null?void 0:i.status)==="Draft"?"Publish":"Unpublish",iconLeft:((m=a(l).data)==null?void 0:m.status)!=="Published"&&"globe",onClick:t[0]||(t[0]=C=>a(N)())},null,8,["label","iconLeft"])]))]}),key:"0"}]),1024),a(l).loading?A("",!0):(c(),f("div",ot,[o("div",{class:ve(["flex flex-col gap-3 p-4 w-full",r.value&&"border rounded-lg overflow-hidden"])},[o("div",nt,[o("div",it,[o("div",rt,[o("div",ct,[d(a(Ae),{image:a(l).data.author.image,label:a(l).data.author.name},null,8,["image","label"]),o("span",dt,P(a(l).data.author.name),1)]),d(a(at),{class:"h-4 w-4 text-gray-600"}),o("div",ut,P(a(ke)(a(l).data.modified).short()),1)]),!r.value&&!a(b)?(c(),S(a(Ve),{key:0,options:se.value},{default:w(()=>[d(a(L),{variant:"ghost"},{icon:w(()=>[d(a(He),{class:"h-4 w-4"})]),_:1})]),_:1},8,["options"])):A("",!0),r.value?(c(),f("div",ft,[d(Je,{"hide-dialog":!k.value,title:"Discard changes?",message:"Are you sure you want to discard changes?",onDiscard:O},null,8,["hide-dialog"]),d(a(L),{label:"Save",onClick:Q,variant:"solid"})])):A("",!0)]),me(o("textarea",{ref_key:"titleRef",ref:E,class:"w-full resize-none border-0 text-3xl font-bold placeholder-ink-gray-3 p-0 pb-3 border-b border-gray-200 focus:ring-0 focus:border-gray-200 overflow-hidden","onUpdate:modelValue":t[1]||(t[1]=i=>_.value=i),placeholder:"Title",rows:"1",wrap:"soft",maxlength:"140",autofocus:"",disabled:!r.value},null,8,mt),[[he,_.value]])]),d(a(Se),{ref_key:"editorRef",ref:x,"editor-class":ae.value,content:X.value,extensions:[a($e)],editable:r.value,onChange:t[2]||(t[2]=i=>{y.value=i}),placeholder:"Write your article here..."},j({_:2},[r.value?{name:"bottom",fn:w(()=>[d(a(Le),{class:"-ml-1 overflow-x-auto w-full",buttons:a(pe)},null,8,["buttons"])]),key:"0"}:void 0]),1032,["editor-class","content","extensions","editable"])],2),a(b)?(c(),f("div",ht,[d(Xe,{feedback:T.value,"article-id":u.articleId},null,8,["feedback","article-id"])])):A("",!0)])),d(ye,{modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=i=>H.value=i),onMove:W},null,8,["modelValue"])]))}});export{$t as default};
//# sourceMappingURL=Article-8b7ce3f0.js.map
