import{j as Z,k as I,l as m,e as g,aw as ee,a2 as A,c as D,d as M,A as k,W as te,Q as V,g as p,w as S,h as r,r as G,F as T,G as J,s as ae,t as K,y as R,f as N,a$ as Q,b1 as le,b2 as oe,H as W,b3 as j,b4 as ne,aP as se,b5 as re,ay as ie,a as ue,b0 as ce,Y as de,I as me,N as pe,S as ve}from"./index-62a62e6e.js";import{_ as Y}from"./Avatar.vue_vue_type_script_setup_true_lang-d4d1e36b.js";import{u as fe}from"./pageMeta-71b2b81d.js";import{a as _e}from"./more-horizontal-44c34a82.js";import"./dayjs-23c9994e.js";import{L as ge}from"./knowledgeBase-e21cae7f.js";import{_ as Ce}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-678127e3.js";import{F as ye}from"./FileUploader-08f99e92.js";import{_ as he}from"./Link-2b0a1c2c.js";import{s as $}from"./dialogState-bafa17dc.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-8f31c9b1.js";import"./NestedPopover-3f769b77.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-4c092d39.js";import"./StarRating.vue_vue_type_script_setup_true_lang-af2bc1e1.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-009f88f9.js";import"./globalStore-353b4b5d.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-93e50375.js";const be={},xe={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ve(v,c){return g(),I("svg",xe,[...c[0]||(c[0]=[m("path",{d:"M10.381 15.0091L13.0108 12.8044C13.3009 12.5612 13.7186 12.5445 14.0272 12.7639L16.5838 14.5815C17.0394 14.9054 17.0522 15.5775 16.6093 15.9186L15.6001 16.6955C14.9561 17.1913 14.0933 17.2956 13.3711 16.9225C11.824 16.1231 9.08016 14.5487 7.11025 12.5456C5.21236 10.6158 3.81881 8.0839 3.08578 6.57321C2.70649 5.79154 2.88609 4.87094 3.48778 4.24418L4.42402 3.26893C4.7989 2.87842 5.441 2.94435 5.72871 3.40288L7.34325 5.976C7.55012 6.3057 7.50072 6.73477 7.22432 7.00882L4.62919 9.58191",stroke:"currentColor","stroke-linejoin":"round"},null,-1)])])}const ke=Z(be,[["render",Ve]]),Ne=ee("contact",()=>{const v=A({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:D(()=>{var f;return((f=v.list)==null?void 0:f.data)||[]})}}),Ee={class:"space-y-4"},we={class:"mb-2 block text-sm leading-4 text-gray-700"},$e={key:0,class:"place-self-center text-red-500"},De={class:"flex justify-end space-x-2"},Ie=M({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(v,{emit:c}){const f=v,_=c,d=Ne(),l=k({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null}),u=k({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),x=[{label:"Email Id",value:"emailID",error:"emailValidationError",type:"input",required:!0,action:()=>F(l.value.emailID)},{label:"First Name",value:"firstName",error:"firstNameValidationError",type:"input",required:!0,action:()=>q(l.value.firstName)},{label:"Last Name",value:"lastName",error:"lastNameValidationError",type:"input",required:!1},{label:"Phone",value:"phone",error:"phoneValidationError",type:"input",required:!1,action:()=>H(l.value.phone)},{label:"Customer",value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",required:!1}],i=D({get:()=>f.modelValue,set:o=>{_("update:modelValue",o),o||_("close")}}),s=A({doctype:"HD Customer",fields:["name"],cache:"customers",transform:o=>o.map(e=>({label:e.name,value:e.name})),auto:!0}),a=te({url:"frappe.client.insert",onSuccess:()=>{l.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null},V.success("Contact created"),_("contactCreated")}});function E(){if(L())return;let o={doctype:"Contact",first_name:l.value.firstName,last_name:l.value.lastName,email_ids:[{email_id:l.value.emailID,is_primary:!0}],links:[],phone_nos:[]};l.value.phone&&(o.phone_nos=[{phone:l.value.phone}]),l.value.selectedCustomer&&o.links.push({link_doctype:"HD Customer",link_name:l.value.selectedCustomer}),a.submit({doc:o})}function h(o){!o||o.label==="No label"?l.value.selectedCustomer=null:l.value.selectedCustomer=o.value}function L(){let o=F(l.value.emailID);return o+=q(l.value.firstName),o+=H(l.value.phone),o}function F(o){u.value.emailValidationError="";const e=j.string().email().safeParse(o).success;return o?e?U(d.options).includes(o)&&(u.value.emailValidationError="Contact with email already exists"):u.value.emailValidationError="Enter a valid email":u.value.emailValidationError="Email should not be empty",u.value.emailValidationError}function q(o){return u.value.firstNameValidationError="",(!o||o.trim()==="")&&(u.value.firstNameValidationError="First name should not be empty"),u.value.firstNameValidationError}function H(o){return u.value.phoneValidationError="",o&&(!/[0-9]+/.test(o)||o.length<10)&&(u.value.phoneValidationError="Enter a valid phone number"),u.value.phoneValidationError}function U(o){return o.map(e=>e.email_id)}return(o,e)=>{const t=G("Button");return g(),I("div",null,[p(r(W),{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=n=>i.value=n),options:{title:"Create New Contact"}},{"body-content":S(()=>[m("div",Ee,[(g(),I(T,null,J(x,n=>m("div",{key:n.label,class:"flex flex-col gap-1"},[m("span",we,[ae(K(n.label)+" ",1),n.required?(g(),I("span",$e," * ")):R("",!0)]),n.type==="input"?(g(),N(r(Q),{key:0,modelValue:l.value[n.value],"onUpdate:modelValue":C=>l.value[n.value]=C,type:"text",onBlur:n.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(g(),N(r(le),{key:1,modelValue:l.value[n.value],"onUpdate:modelValue":[C=>l.value[n.value]=C,h],options:r(s).data},null,8,["modelValue","onUpdate:modelValue","options"])),p(r(oe),{message:u.value[n.error]},null,8,["message"])])),64)),m("div",De,[p(t,{label:"Create",loading:r(a).loading,theme:"gray",variant:"solid",onClick:e[0]||(e[0]=n=>E())},null,8,["loading"])])])]),_:1},8,["modelValue"])])}}}),Se={__name:"Pill",props:{label:{type:String,default:"Button",require:!0},disabled:{type:Boolean,default:!1}},emits:["click"],setup(v,{emit:c}){const f=c,_=d=>{f("click",d)};return(d,l)=>(g(),N(r(se),{key:v.label,theme:"gray",variant:"outline",label:v.label,disabled:v.disabled},{suffix:S(()=>[p(r(ne),{class:"h-3 w-3",onClick:l[0]||(l[0]=u=>_(v.label))})]),_:1},8,["label","disabled"]))}},Ue={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},O=M({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(v,{emit:c}){const f=v,_=c,{items:d}=re(f),l=k("");function u(i){const s=f.validate(i);if(s){V.error(s);return}const a=[...d.value,i];_("update:items",a),l.value=""}function x(i){const s=d.value.filter(a=>a.value!==i);_("update:items",s)}return(i,s)=>(g(),I("div",Ue,[(g(!0),I(T,null,J(r(d),a=>(g(),N(Se,{key:a.value,label:a.label,onClick:s[0]||(s[0]=E=>x(E))},null,8,["label"]))),128)),p(r(Q),{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=a=>l.value=a),class:"w-full",placeholder:v.placeholder,onKeyup:s[2]||(s[2]=ie(a=>u({label:l.value,value:l.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),Be={class:"flex flex-col items-center gap-4 p-6"},Pe={class:"text-xl font-medium text-gray-900"},Le={class:"flex gap-2"},Fe={class:"w-full space-y-2 text-sm text-gray-700"},qe={class:"space-y-1"},He={class:"space-y-1"},Re={class:"space-y-1"},Me=M({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(v,{emit:c}){const f=v,_=c,d=k(!1),l=D({get(){var t;return(((t=a.doc)==null?void 0:t.email_ids)||[]).map(n=>({label:n.email_id,value:n.email_id}))},set(e){if(e.length===0){V.error("At least one email is required");return}e.length!==a.doc.email_ids.length&&(d.value=!0),a.doc.email_ids=e.map(t=>({email_id:t.value}))}}),u=D({get(){var t;return(((t=a.doc)==null?void 0:t.phone_nos)||[]).map(n=>({label:n.phone,value:n.phone}))},set(e){e.length!==a.doc.phone_nos.length&&(d.value=!0),a.doc.phone_nos=e.map(t=>({phone:t.value}))}}),x=D({get(){var t,n;const e=(n=(t=a.doc)==null?void 0:t.links)==null?void 0:n.find(C=>C.link_doctype==="HD Customer");return(e==null?void 0:e.link_name)||null},set(e){var n,C,w,B,P;const t=(w=(C=(n=a.doc)==null?void 0:n.links)==null?void 0:C.find(b=>b.link_doctype==="HD Customer"))==null?void 0:w.link_name;if(e!==t){if(e){const b=(B=a.doc.links)==null?void 0:B.findIndex(y=>y.link_doctype==="HD Customer");b!==-1?a.doc.links[b].link_name=e:a.doc.links.push({link_doctype:"HD Customer",link_name:e})}else a.doc.links=(P=a.doc.links)==null?void 0:P.filter(b=>b.link_doctype!=="HD Customer");d.value=!0}}});A({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(t=>({label:t.name,value:t.name})),auto:!0});const{updateOnboardingStep:i}=_e("helpdesk"),{isManager:s}=ue(),a=ce({doctype:"Contact",name:f.name,auto:!0,setValue:{onSuccess(){_("contactUpdated")}}}),E=D(()=>{var e;return{title:(e=a.doc)==null?void 0:e.name,actions:[{label:"Save",theme:"gray",variant:"solid",onClick:()=>h()}]}});function h(){if(!d.value){V.error("No changes to save");return}a.setValue.submit({email_ids:l.value.map(e=>({email_id:e.value,is_primary:e.value===a.doc.email_id})),phone_nos:u.value.map(e=>({phone:e.value,is_primary_phone:e.value===a.doc.phone,is_primary_mobile:e.value===a.doc.phone})),links:a.doc.links}),d.value=!1,_("contactUpdated")}function L(e){a.setValue.submit({image:(e==null?void 0:e.file_url)||null}),d.value=!0}function F(e){if(!j.string().email().safeParse(e.value).success)return"Invalid email"}function q(e){if(!j.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(e.value).success)return"Invalid phone number"}function H(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return V.error("Invalid file type, only PNG and JPG images are allowed"),"Invalid file type, only PNG and JPG images are allowed"}const U=k(!1);async function o(){var e;try{U.value=!0;const t=await de("frappe.contacts.doctype.contact.contact.invite_user",{contact:a.doc.name});V.success("Contact invited successfully"),await a.setValue.submit({user:t}),i("add_invite_contact")}catch(t){U.value=!1;const w=new DOMParser().parseFromString(((e=t.messages)==null?void 0:e[0])||t.message,"text/html").body.innerText;V.error(w)}finally{U.value=!1}}return(e,t)=>{const n=G("Button");return g(),N(r(W),{options:E.value},{"body-main":S(()=>{var C,w,B,P,b;return[m("div",Be,[m("div",Pe,K((C=r(a).doc)==null?void 0:C.full_name),1),p(r(Y),{size:"2xl",label:(w=r(a).doc)==null?void 0:w.full_name,image:(B=r(a).doc)==null?void 0:B.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),m("div",Le,[p(r(ye),{"validate-file":H,onSuccess:t[0]||(t[0]=y=>L(y))},{default:S(({uploading:y,openFileSelector:X})=>{var z;return[p(n,{label:(z=r(a).doc)!=null&&z.image?"Change photo":"Upload photo",loading:y,onClick:X},null,8,["label","loading","onClick"])]}),_:1}),(P=r(a).doc)!=null&&P.image?(g(),N(n,{key:0,label:"Remove photo",onClick:t[1]||(t[1]=y=>L(null))})):R("",!0),!((b=r(a).doc)!=null&&b.user)&&r(s)?(g(),N(n,{key:1,label:"Invite as user",onClick:o,loading:U.value},null,8,["loading"])):R("",!0)]),m("div",Fe,[m("div",qe,[t[5]||(t[5]=m("div",{class:"text-xs"},"Emails",-1)),p(O,{items:l.value,"onUpdate:items":t[2]||(t[2]=y=>l.value=y),placeholder:"john.doe@example.com",validate:F},null,8,["items"])]),m("div",He,[t[6]||(t[6]=m("div",{class:"text-xs"},"Phone Nos",-1)),p(O,{items:u.value,"onUpdate:items":t[3]||(t[3]=y=>u.value=y),placeholder:"+91 98765 43210",validate:q},null,8,["items"])]),m("div",Re,[t[7]||(t[7]=m("div",{class:"text-xs"},"Customer",-1)),p(he,{doctype:"HD Customer",class:"form-control flex-1",placeholder:"Link to a customer",modelValue:x.value,"onUpdate:modelValue":t[4]||(t[4]=y=>x.value=y),"hide-me":!0},null,8,["modelValue"])])])])]}),_:1},8,["options"])}}}),je={class:"flex flex-col"},nt=M({__name:"Contacts",setup(v){const c=k(!1),f=k(null),_=k(null),d=D(()=>({doctype:"Contact",selectable:!0,showSelectBanner:!0,columnConfig:{full_name:{prefix:({row:i})=>me(Y,{shape:"circle",image:i.image,label:i.name,size:"sm"})},mobile_no:{prefix:ke}},emptyState:{title:"No Contacts Found"}}));function l(){var i;$.value=!1,(i=_.value)==null||i.reload()}function u(i){f.value=i,c.value=!0}function x(){var i;V.success("Contact updated"),c.value=!c.value,(i=_.value)==null||i.reload()}return fe(()=>({title:"Contacts"})),(i,s)=>{const a=ve,E=G("Button");return g(),I("div",je,[p(r(ge),null,{"left-header":S(()=>[...s[4]||(s[4]=[m("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])]),"right-header":S(()=>[p(E,{label:"New contact",theme:"gray",variant:"solid",onClick:s[0]||(s[0]=h=>$.value=!r($))},{prefix:S(()=>[p(a,{class:"h-4 w-4"})]),_:1})]),_:1}),p(r(Ce),{ref_key:"listViewRef",ref:_,options:d.value,onRowClick:u,onEmptyStateAction:s[1]||(s[1]=h=>$.value=!0)},null,8,["options"]),p(Ie,{modelValue:r($),"onUpdate:modelValue":s[2]||(s[2]=h=>pe($)?$.value=h:null),onContactCreated:l},null,8,["modelValue"]),c.value?(g(),N(Me,{key:f.value,modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=h=>c.value=h),name:f.value,onContactUpdated:x},null,8,["modelValue","name"])):R("",!0)])}}});export{nt as default};
//# sourceMappingURL=Contacts-d0c03d62.js.map
