import{c as h,r as g,e as i,k as u,F as f,G as v,f as y,aJ as A,w as d,g as _,y as b,h as k}from"./index-62a62e6e.js";import{_ as C}from"./Dropdown.vue_vue_type_script_setup_true_lang-8f31c9b1.js";const L={key:0,class:"flex gap-2"},j={key:2},N={__name:"CustomActions",props:{actions:{type:Object,required:!0}},setup(e){const a=e,n=h(()=>a.actions.filter(s=>!s.group)),t=h(()=>{let s=[];return a.actions.filter(o=>o.buttonLabel&&o.group).forEach(o=>{let c=s.findIndex(p=>p.label===o.buttonLabel);c>-1?s[c].action.push(o):s.push({label:o.buttonLabel,action:[o]})}),s}),r=h(()=>{let s=[];return s=s.concat(a.actions.filter(o=>o.group&&!o.buttonLabel)),s});return(s,o)=>{const c=g("FeatherIcon"),p=g("Button");return i(),u(f,null,[n.value.length?(i(),u("div",L,[(i(!0),u(f,null,v(n.value,l=>(i(),y(p,{key:l.label,label:l.label,onClick:m=>l.onClick()},A({_:2},[l.icon?{name:"prefix",fn:d(()=>[_(c,{name:l.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["label","onClick"]))),128))])):b("",!0),r.value.length?(i(),y(k(C),{key:1,options:r.value},{default:d(()=>[_(p,{icon:"more-horizontal"})]),_:1},8,["options"])):b("",!0),t.value.length?(i(),u("div",j,[(i(!0),u(f,null,v(t.value,l=>(i(),u("div",{key:l.label},[_(k(C),{options:l.action},{default:d(({open:m})=>[_(p,{label:l.label},{suffix:d(()=>[_(c,{name:m?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):b("",!0)],64)}}};async function q(e,a){let n=e==null?void 0:e.data;if(!n)return;if(!n._form_script)return[];let t=[],r={};if(Array.isArray(n._form_script))for(const s of n._form_script){const o=await w(s,a);t=t.concat(o.actions),o.onChange&&F(r,o.onChange)}else{const s=await w(n._form_script,a);t=s.actions,s.onChange&&F(r,s.onChange)}n._customActions=t,Object.keys(r).length&&(n._customOnChange=r)}function F(e,a){for(const[n,t]of Object.entries(a))e[n]||(e[n]=new Set),e[n].add(t)}async function w(e,a){const t=await new Function(e+`
return setupForm`)()(a);return{actions:(t==null?void 0:t.actions)||[],onChange:(t==null?void 0:t.onChange)||null}}function E(e,a,n,t,r){!n||!n.length?(e.options=r.find(s=>s.fieldname===a).options,e.disabled=!0):(e.options=n.join(`
`),e.disabled=!1),t[a]=""}function J(e,a,n,t,r){if(!n||!n.length){e.link_filters=r.find(s=>s.fieldname===a).link_filters,e.disabled=!0;return}e.link_filters=JSON.stringify([[e.options,"name","in",n]]),e.disabled=!1,t[a]=""}function S(e,a){return{display_via_depends_on:O(e==null?void 0:e.depends_on,a),...e,required:e.required||e.mandatory_depends_on&&O(e.mandatory_depends_on,a),filters:e.link_filters&&JSON.parse(e.link_filters),disabled:e.disabled}}function O(e,a){if(!e)return!0;let n=null;if(e.substr(0,5)=="eval:")try{n=x(e.substr(5),{doc:a})}catch{n=!0}else if(e.substr(0,4)=="doc.")n=a[e.substr(4)];else{let t=a[e];Array.isArray(t)?n=!!t.length:n=!!t}return n}function x(e,a={}){let n=Object.keys(a),t=Object.values(a);e=`let out = ${e}; return out`;try{return new Function(...n,e)(...t)}catch(r){throw console.log("Error evaluating the following expression:"),console.error(e),r}}export{N as _,J as a,E as h,S as p,q as s};
//# sourceMappingURL=formCustomisation-2c9d6b04.js.map
