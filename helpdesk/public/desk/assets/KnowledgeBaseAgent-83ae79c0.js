import{d as M,m as x,n as V,c as H,A as m,a3 as O,f as U,w as b,h as _,e as S,l as w,aA as Q,aY as W,H as E,r as Y,s as $,t as j,g,u as z,p as F,W as X,I as D,J as Z,M as ee,aR as B,k as te,a4 as le,Q as d,R as ae,aP as oe,S as se}from"./index-62a62e6e.js";import{L as re,m as ie,n as ne,a as ue,d as ce,b as de,c as ge}from"./knowledgeBase-e21cae7f.js";import{_ as me}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-678127e3.js";import"./more-horizontal-44c34a82.js";import"./dayjs-23c9994e.js";import{_ as pe}from"./Link-2b0a1c2c.js";import{_ as fe}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-f78418d8.js";import{g as ye}from"./globalStore-353b4b5d.js";import{_ as ve}from"./Dropdown.vue_vue_type_script_setup_true_lang-8f31c9b1.js";import{u as be}from"./pageMeta-71b2b81d.js";import{L as Ce}from"./merge-36299d39.js";import"./NestedPopover-3f769b77.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-4c092d39.js";import"./StarRating.vue_vue_type_script_setup_true_lang-af2bc1e1.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-009f88f9.js";import"./Avatar.vue_vue_type_script_setup_true_lang-d4d1e36b.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-93e50375.js";const he={class:"flex flex-col flex-1 gap-3"},_e=M({__name:"CategoryModal",props:x({title:{type:String,default:""},edit:{type:Boolean,default:!1}},{modelValue:{type:Boolean},modelModifiers:{},title:{},titleModifiers:{}}),emits:x(["update","create"],["update:modelValue","update:title"]),setup(C,{emit:f}){const y=C,l=f,c=V(C,"modelValue"),r=V(C,"title"),a=H(()=>y.edit?"Edit Category":"Create Category"),n=m(null);O(()=>n.value,i=>{i&&(n.value.style.height=(i.scrollHeight>i.clientHeight,i.scrollHeight+"px"))});function u(){const i=[];return y.edit?i.push({label:"Save",variant:"solid",onClick:()=>{l("update")}}):i.push({label:"Create",variant:"solid",onClick:()=>{l("create")}}),i}return(i,p)=>(S(),U(_(E),{modelValue:c.value,"onUpdate:modelValue":p[2]||(p[2]=v=>c.value=v),options:{title:a.value,actions:u()}},{"body-content":b(()=>[w("div",he,[Q(w("textarea",{class:"text-base rounded py-1.5 px-2 border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full block",ref_key:"titleRef",ref:n,placeholder:"Support Issues","onUpdate:modelValue":p[0]||(p[0]=v=>r.value=v),rows:1,maxlength:"50",autofocus:"",onInput:p[1]||(p[1]=v=>{const k=v.target;k.style.height=`${k.scrollHeight}px`})},null,544),[[W,r.value]])])]),_:1},8,["modelValue","options"]))}}),we={class:"text-p-base text-ink-gray-8 mb-4"},ke={class:"whitespace-nowrap font-semibold"},Ae=M({__name:"MergeCategoryModal",props:x({categoryId:{},categoryTitle:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:x(["merge"],["update:modelValue"]),setup(C,{emit:f}){const y=f,l=V(C,"modelValue"),c=m("");return(r,a)=>{const n=Y("Button");return S(),U(_(E),{options:{title:"Merge with another category"},onAfterLeave:a[2]||(a[2]=()=>{c.value=null}),modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value=u)},{"body-content":b(()=>[w("p",we,[a[4]||(a[4]=$(" This will move all articles of the ",-1)),w("span",ke,j(r.categoryTitle),1),a[5]||(a[5]=$(" category to the selected category. This change is irreversible! ",-1))]),g(_(pe),{class:"form-control",doctype:"HD Article Category",placeholder:"Select Category",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=u=>c.value=u),label:"Category","page-length":100},null,8,["modelValue"])]),actions:b(()=>[g(n,{class:"w-full",variant:"solid",label:"Merge",onClick:a[1]||(a[1]=u=>y("merge",r.categoryId,c.value))})]),_:1},8,["modelValue"])}}}),xe={class:"flex flex-col"},Ke=M({__name:"KnowledgeBaseAgent",setup(C){const f=z(),{$dialog:y}=ye(),l=F({title:"",id:""}),c=m(""),r=m(null),a=m(!1),n=m(!1),u=m(!1),i=m(!1),p=X({url:"helpdesk.api.knowledge_base.get_general_category",auto:!0,cache:["GeneralCategory"]}),v=[{label:"Category",icon:"folder",onClick:()=>{A(),a.value=!1,n.value=!0}},{label:"Article",icon:"file-text",onClick:()=>{f.push({name:"NewArticle",params:{id:p.data},query:{title:"General"}})}}],k=[{label:"Add New Article",icon:"plus",onClick:e=>{f.push({name:"NewArticle",params:{id:e.group.value},query:{title:e.group.label}})}},{label:"Edit Title",icon:"edit",onClick:e=>{a.value=!0,n.value=!0,l.title=e.group.label,l.id=e.group.value,c.value=e.group.label}},{label:"Merge",icon:Ce,onClick:e=>{i.value=!0,l.title=e.group.label,l.id=e.group.value}},{label:"Share",icon:"link",onClick:async({group:e})=>{const{label:t,value:o}=e,s=new URL(window.location.href);s.pathname=`/helpdesk/kb-public/${o}`,await le()}},{label:"Delete",icon:"trash-2",onClick:e=>{P(e)}}],h=m(new Set),R=[{label:"Move To",icon:"corner-up-right",onClick:e=>{h.value=new Set(e),u.value=!0}},{label:"Delete",icon:"trash-2",onClick:e=>{h.value=e,y({title:"Delete articles?",message:"Are you sure you want to delete these articles?",actions:[{label:"Confirm",variant:"solid",onClick({close:t}){q(),t()}}]})}}];function I(e){ie.submit({category:e,articles:Array.from(h.value)},{onSuccess:()=>{var t,o;u.value=!1,(t=r.value)==null||t.reload(),(o=r.value)==null||o.unselectAll(),h.value.clear(),d.success("Articles moved")},onError:t=>{var s;const o=((s=t==null?void 0:t.messages)==null?void 0:s[0])||t.message;d.error(o),u.value=!1}})}function L(){ne.submit({title:l.title},{onSuccess:e=>{r.value.reload(),n.value=!1,f.push({name:"Article",params:{articleId:e.article},query:{category:e.category,title:l.title,isEdit:1}}),d.success("Category created"),B("category_created",{data:{category:l.title}}),A()},onError:e=>{d.error(e)}})}function N(){if(l.title===c.value){n.value=!1,a.value=!1;return}ue.submit({doctype:"HD Article Category",name:l.id,fieldname:"category_name",value:l.title},{onSuccess:()=>{r.value.reload(),n.value=!1,a.value=!1,d.success("Category updated"),A()},onError:e=>{d.error(e)}})}function P(e){y({title:"Delete category?",message:"All articles from this category will move to General category.",actions:[{label:"Confirm",variant:"solid",onClick(t){ce.submit({doctype:"HD Article Category",name:e.group.value},{onSuccess:()=>{d.success("Category deleted"),r.value.reload()}}),t()}}]})}function q(){de.submit({articles:Array.from(h.value)},{onSuccess:()=>{var e,t,o;(e=r.value)==null||e.reload(),(t=r.value)==null||t.unselectAll(),(o=h.value)==null||o.clear(),d.success("Articles deleted")}})}function G(e,t){ge.submit({source:e,target:t},{onSuccess:()=>{r.value.reload(),d.success("Category merged"),i.value=!1,A()},onError:o=>{var T;const s=((T=o==null?void 0:o.messages)==null?void 0:T[0])||o.message;d.error(s)}})}function A(){l.title="",l.id="",c.value=""}const K=H(()=>({doctype:"HD Article",selectable:!0,view:{view_type:"group_by",group_by_field:"category",label_doc:"HD Article Category",label_field:"category_name"},columnConfig:{title:{prefix:()=>D(ae,{name:"file-text",class:"h-4 w-4 flex-shrink-0 text-ink-gray-6"})},status:{custom:({item:e})=>D(Z,{...J[e]})}},rowRoute:{name:"Article",prop:"articleId"},groupByActions:k,showSelectBanner:!0,selectBannerActions:R,default_page_length:100})),J={Published:{label:"Published",theme:"green"},Draft:{label:"Draft",theme:"orange"},Archived:{label:"Archived",theme:"gray"}};return ee(()=>{B("kb_agent_page_viewed")}),be(()=>({title:"Knowledge Base"})),(e,t)=>{const o=se;return S(),te("div",xe,[g(re,null,{"left-header":b(()=>[...t[5]||(t[5]=[w("div",{class:"text-lg font-medium text-gray-900"},"Knowledge Base",-1)])]),"right-header":b(()=>[g(_(ve),{options:v},{default:b(()=>[g(_(oe),{label:"Add new",variant:"solid"},{prefix:b(()=>[g(o,{class:"h-4 w-4"})]),_:1})]),_:1})]),_:1}),g(me,{ref_key:"listViewRef",ref:r,options:K.value,onRowClick:t[0]||(t[0]=s=>e.$router.push(`kb/articles/${s}`))},null,8,["options"]),g(_e,{edit:a.value,modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=s=>n.value=s),title:l.title,"onUpdate:title":t[2]||(t[2]=s=>l.title=s),onUpdate:N,onCreate:L},null,8,["edit","modelValue","title"]),g(fe,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s),onMove:I},null,8,["modelValue"]),g(Ae,{categoryTitle:l.title,"category-id":l.id,modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=s=>i.value=s),onMerge:G},null,8,["categoryTitle","category-id","modelValue"])])}}});export{Ke as default};
//# sourceMappingURL=KnowledgeBaseAgent-83ae79c0.js.map
