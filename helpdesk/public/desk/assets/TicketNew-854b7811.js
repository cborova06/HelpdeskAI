import{s as W,p as J,h as X,a as Z,_ as ee}from"./formCustomisation-2c9d6b04.js";import{d as P,c as k,I as y,$ as z,W as E,e as m,k as f,l as p,s as H,t as te,y as v,f as F,v as ae,q as le,u as se,a as oe,A as V,p as ie,K as h,aQ as ne,aR as L,M as re,g as _,w as T,h as i,F as ue,G as de,x as ce,aA as B,aE as j,Y as me,aP as q,au as pe}from"./index-62a62e6e.js";import{_ as fe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c8f73628.js";import{u as ve}from"./pageMeta-71b2b81d.js";import{a as he}from"./more-horizontal-44c34a82.js";import"./dayjs-23c9994e.js";import{L as _e}from"./knowledgeBase-e21cae7f.js";import{_ as A}from"./Autocomplete-b8bbe20a.js";import{_ as ge}from"./Link-2b0a1c2c.js";import{g as ke}from"./globalStore-353b4b5d.js";import{s as M}from"./index-81b6d358.js";import{_ as be}from"./SearchArticles.vue_vue_type_script_setup_true_lang-085e8347.js";import{_ as O}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-7ec8927e.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-8f31c9b1.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-cb2930a7.js";import"./FileUploader-08f99e92.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-3540b034.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-3c21d3f7.js";import"./Avatar.vue_vue_type_script_setup_true_lang-d4d1e36b.js";const ye={key:0,class:"space-y-1.5"},xe={class:"block text-sm text-gray-700"},Ce={key:0,class:"place-self-center text-red-500"},we=P({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(S,{emit:x}){const o=S,$=x,N=k(()=>o.field.url_method?y(A,{options:D.data}):o.field.fieldtype==="Link"&&o.field.options?y(ge,{doctype:o.field.options,filters:o.field.filters}):o.field.fieldtype==="Select"?y(A,{options:o.field.options.split(`
`).map(l=>({label:l,value:l}))}):o.field.fieldtype==="Check"?y(A,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):y(z,{debounce:500})),D=E({url:o.field.url_method,auto:!!o.field.url_method,transform:l=>(l==null?void 0:l.map(s=>({label:s,value:s})))||[]}),b=k(()=>o.field.fieldtype==="Check"?o.value?"Yes":"No":o.value),c=k(()=>o.field.fieldtype==="Data"&&!o.field.url_method?"Type something":"Select an option");function d(l,s){$("change",{fieldname:l,value:s})}return(l,s)=>l.field.display_via_depends_on?(m(),f("div",ye,[p("span",xe,[H(te(l.field.label)+" ",1),l.field.required?(m(),f("span",Ce," * ")):v("",!0)]),(m(),F(ae(N.value),{placeholder:c.value,value:b.value,disabled:l.field.disabled,"model-value":b.value,"onUpdate:modelValue":s[0]||(s[0]=n=>d(l.field.fieldname,n)),onChange:s[1]||(s[1]=n=>{var C;return d(l.field.fieldname,((C=n.target)==null?void 0:C.value)||n.value||n)})},null,40,["placeholder","value","disabled","model-value"]))])):v("",!0)}}),Te={class:"flex flex-col overflow-y-auto"},Fe={class:"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5"},Se={key:0,class:""},$e=["innerHTML"],Ne={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},De={class:"flex flex-col gap-2"},Ie={key:1},Ue={class:"text-p-sm text-gray-500 ml-1"},Ve={key:2},Ze=P({__name:"TicketNew",props:{templateId:{default:""}},setup(S){const x=S;le();const o=se(),{$dialog:$}=ke(),{updateOnboardingStep:N}=he("helpdesk"),{isManager:D,userId:b}=oe(),c=V(""),d=V(""),l=V([]),s=ie({}),n=E({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:x.templateId||"Default"}),auto:!0,onSuccess:e=>{d.value=e.description_template||"",I=window.structuredClone(e.fields||[]),W(n,{doc:s,call:me,router:o,$dialog:$,applyFilters:R}),C(e.fields)}});function C(e){e.forEach(a=>{s[a.fieldname]=""})}let I=[];function R(e,a=null){const r=n.data.fields.find(u=>u.fieldname===e);r&&(r.fieldtype==="Select"?X(r,e,a,s,I):r.fieldtype==="Link"&&Z(r,e,a,s,I))}const Y=k(()=>{var e;return(e=n.data)==null?void 0:e._customOnChange}),U=k(()=>{var a,r;let e=(r=(a=n.data)==null?void 0:a.fields)==null?void 0:r.filter(u=>!h.value||!u.hide_from_customer);return e?e.map(u=>J(u,s)):[]});function G(e,a,r){var t;s[a]=e.value;const u=(t=Y.value)==null?void 0:t[a];u&&u.forEach(g=>{g(e.value,r)})}const w=E({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:d.value,subject:c.value,template:x.templateId,...s},attachments:l.value}),validate:e=>{var u;const r=[...((u=U.value)==null?void 0:u.filter(t=>t.required))||[],"subject","description"];for(const t of r)if(ne.isEmpty(e.doc[t.fieldname||t]))return`${t.label||t} is required`},onSuccess:e=>{o.push({name:h.value?"TicketCustomer":"TicketAgent",params:{ticketId:e.name}}),D&&N("create_first_ticket",!0,!1,()=>localStorage.setItem("firstTicket",e.name)),h.value&&L("new_ticket_submitted",{data:{user:b,ticketID:e.name,subject:c.value,description:d.value,customFields:s}})}});function K(e){return M(e,{allowedTags:M.defaults.allowedTags.concat(["img"])})}const Q=k(()=>[{label:"Tickets",route:{name:h.value?"TicketsCustomer":"TicketsAgent"}},{label:"New Ticket",route:{name:"TicketNew"}}]);return ve(()=>({title:"New Ticket"})),re(()=>{L("new_ticket_page",{data:{user:b}})}),(e,a)=>{var u;const r=ee;return m(),f("div",Te,[_(i(_e),null,{"left-header":T(()=>[_(i(fe),{items:Q.value},null,8,["items"])]),"right-header":T(()=>{var t,g;return[(t=i(n).data)!=null&&t._customActions?(m(),F(r,{key:0,actions:(g=i(n).data)==null?void 0:g._customActions},null,8,["actions"])):v("",!0)]}),_:1}),p("div",Fe,[(u=i(n).data)!=null&&u.about?(m(),f("div",Se,[p("div",{class:"prose-f",innerHTML:K(i(n).data.about)},null,8,$e)])):v("",!0),U.value?(m(),f("div",Ne,[(m(!0),f(ue,null,de(U.value,t=>(m(),F(i(we),{key:t.fieldname,field:t,value:s[t.fieldname],onChange:g=>G(g,t.fieldname,t.fieldtype)},null,8,["field","value","onChange"]))),128))])):v("",!0),p("div",{class:ce(["flex flex-col",(c.value.length>=2||d.value.length)&&"gap-5"])},[p("div",De,[a[7]||(a[7]=p("span",{class:"block text-sm text-gray-700"},[H(" Subject "),p("span",{class:"place-self-center text-red-500"}," * ")],-1)),_(i(z),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),type:"text",placeholder:"A short description"},null,8,["modelValue"])]),i(h)?(m(),F(be,{key:0,query:c.value,class:"shadow"},null,8,["query"])):v("",!0),i(h)?(m(),f("div",Ie,[B(p("h4",Ue," Please enter a subject to continue ",512),[[j,c.value.length<=2&&d.value.length===0]]),B(_(O,{ref:"editor",attachments:l.value,"onUpdate:attachments":a[2]||(a[2]=t=>l.value=t),content:d.value,"onUpdate:content":a[3]||(a[3]=t=>d.value=t),placeholder:"Detailed explanation",expand:"",uploadFunction:t=>i(pe)(t)},{"bottom-right":T(()=>[_(i(q),{label:"Submit",theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||i(w).loading||!c.value,onClick:a[1]||(a[1]=()=>i(w).submit())},null,8,["disabled"])]),_:1},8,["attachments","content","uploadFunction"]),[[j,c.value.length>2||d.value.length>0]])])):v("",!0)],2),i(h)?v("",!0):(m(),f("div",Ve,[_(O,{ref:"editor",attachments:l.value,"onUpdate:attachments":a[5]||(a[5]=t=>l.value=t),content:d.value,"onUpdate:content":a[6]||(a[6]=t=>d.value=t),placeholder:"Detailed explanation",expand:""},{"bottom-right":T(()=>[_(i(q),{label:"Submit",theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||i(w).loading||!c.value,onClick:a[4]||(a[4]=()=>i(w).submit())},null,8,["disabled"])]),_:1},8,["attachments","content"])]))])])}}});export{Ze as default};
//# sourceMappingURL=TicketNew-854b7811.js.map
