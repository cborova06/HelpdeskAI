import{_ as Z,a as G}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-f4b785e0.js";import{A as K,C as tt,_ as et,a as at,b as st,T as ot,c as nt,d as it,e as lt,f as rt,g as ct}from"./TicketAgentFields-2425efde.js";import{s as ut,_ as dt}from"./formCustomisation-2c9d6b04.js";import{j as mt,e as l,k as v,U as pt,d as ft,V as vt,u as _t,A as p,b as kt,W as N,c as U,I as bt,Q as j,M as yt,X as gt,h as e,f,w as r,y as b,l as d,v as xt,g as i,Y as ht,Z as At,r as R,x as wt,$ as $t,s as F,H as Ct}from"./index-62a62e6e.js";import{_ as Vt}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c8f73628.js";import{_ as It}from"./Dropdown.vue_vue_type_script_setup_true_lang-8f31c9b1.js";import"./more-horizontal-44c34a82.js";import"./dayjs-23c9994e.js";import{L as St}from"./knowledgeBase-e21cae7f.js";import{_ as Tt}from"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-009f88f9.js";import{u as Ut,I as z}from"./ticketStatus-e3b3db3a.js";import{g as jt}from"./globalStore-353b4b5d.js";import"./merge-36299d39.js";import"./StarRating.vue_vue_type_script_setup_true_lang-af2bc1e1.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-cb2930a7.js";import"./FileUploader-08f99e92.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-3540b034.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-3c21d3f7.js";import"./Avatar.vue_vue_type_script_setup_true_lang-d4d1e36b.js";import"./Autocomplete-b8bbe20a.js";import"./Link-2b0a1c2c.js";import"./EmailContent-07157247.js";const Bt={},Mt={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-list-collapse"};function Dt(I,_){return l(),v("svg",Mt,[..._[0]||(_[0]=[pt('<path d="m3 10 2.5-2.5L3 5"></path><path d="m3 19 2.5-2.5L3 14"></path><path d="M10 6h11"></path><path d="M10 12h11"></path><path d="M10 18h11"></path>',5)])])}const Et=mt(Bt,[["render",Dt]]),Lt={class:"flex flex-col"},Nt={class:"absolute right-0 pr-2"},Rt={key:1,class:"flex h-12 items-center justify-between py-[7px] px-3 border-b"},Ft={class:"flex items-center gap-2 max-w-[50%]"},zt={key:0},Ht={class:"flex items-center gap-2"},Pt={key:2,class:"flex flex-1 overflow-x-hidden"},Ot={class:"flex flex-1 flex-col overflow-x-hidden"},qt={class:"flex-1 flex flex-col"},Jt={key:0},ve=ft({__name:"MobileTicketAgent",props:{ticketId:{type:String,required:!0}},setup(I){const _=Ut(),{getUser:B}=vt(),H=_t(),M=p(null),h=p(null),y=p(null),S=p(!1),A=I;At("communicationArea",h);const{isMobileView:P}=kt(),{$dialog:O}=jt(),w=p(!1),$=p(!1),s=N({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_one",cache:["Ticket",A.ticketId],auto:!0,params:{name:A.ticketId},transform:o=>{o._assign&&(o.assignees=JSON.parse(o._assign).map(t=>({name:t,image:B(t).user_image,label:B(t).full_name})))},onSuccess:o=>{y.value=s.subject,ut(s,{doc:o,call:ht,router:H,toast:j,$dialog:O,updateField:q,createToast:j.create})}});function q(o,t,g=()=>{}){C(o,t),g()}const J=U(()=>{var t;let o=[{label:"Tickets",route:{name:"TicketsAgent"}}];return o.push({label:(t=s.data)==null?void 0:t.subject,route:{name:"TicketAgent"}}),o}),Q=U(()=>_.options.map(o=>({label:o,value:o,onClick:()=>C("status",o),icon:()=>bt(z,{class:_.textColorMap[o]})}))),T=p(0),W=[{name:"details",label:"Details",icon:Et,condition:()=>P.value},{name:"activity",label:"Activity",icon:K},{name:"email",label:"Emails",icon:Z},{name:"comment",label:"Comments",icon:tt}],D=U(()=>{const o=s.data.communications.map((a,c)=>({subject:a.subject,content:a.content,sender:{name:a.user.email,full_name:a.user.name},to:a.recipients,type:"email",key:a.creation,cc:a.cc,bcc:a.bcc,creation:a.communication_date||a.creation,attachments:a.attachments,name:a.name,deliveryStatus:a.delivery_status,isFirstEmail:c===0})),t=s.data.comments.map(a=>({name:a.name,type:"comment",key:a.creation,commentedBy:a.commented_by,commenter:a.user.name,creation:a.creation,content:a.content,attachments:a.attachments})),g=[...s.data.history,...s.data.views].map(a=>({type:"history",key:a.creation,content:a.action?a.action:"viewed this",creation:a.creation,user:a.user.name+" "})),u=[...o,...t,...g].sort((a,c)=>new Date(a.creation)-new Date(c.creation)),x=[];let m=0;for(;m<u.length;){const a=u[m];if(a.type==="history"){a.relatedActivities=[a];for(let c=m+1;c<u.length+1;c++){const k=u[c];if(k&&k.user===a.user)a.relatedActivities.push(k);else{x.push(a),m=c-1;break}}}else x.push(a);m++}return x});function X(o){return o==="activity"?D.value:D.value.filter(t=>t.type===o)}function C(o,t){S.value=!0,N({url:"frappe.client.set_value",params:{doctype:"HD Ticket",name:A.ticketId,fieldname:o,value:t},auto:!0,onSuccess:()=>{S.value=!1,s.reload(),j.success("Ticket updated")}})}return yt(()=>{document.title=A.ticketId}),gt(()=>{document.title="Helpdesk"}),(o,t)=>{var c,k,E;const g=R("FeatherIcon"),u=R("Button"),x=dt,m=ct,a=G;return l(),v("div",Lt,[e(s).data?(l(),f(e(St),{key:0},{"left-header":r(()=>[i(e(Vt),{items:J.value},null,8,["items"])]),"right-header":r(()=>[d("div",Nt,[i(e(It),{options:Q.value},{default:r(({open:n})=>[i(u,{label:e(s).data.status},{prefix:r(()=>[i(e(z),{class:wt(e(_).textColorMap[e(s).data.status])},null,8,["class"])]),suffix:r(()=>[i(g,{name:n?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])])]),_:1})):b("",!0),e(s).data?(l(),v("header",Rt,[d("div",Ft,[(c=e(s).data.assignees)!=null&&c.length?(l(),v("div",zt,[(l(),f(xt(e(s).data.assignees.length==1?"Button":"div"),null,{default:r(()=>[i(e(Tt),{avatars:e(s).data.assignees,onClick:t[0]||(t[0]=n=>w.value=!0)},null,8,["avatars"])]),_:1}))])):(l(),v("button",{key:1,class:"rounded bg-gray-100 px-2 py-1.5 text-base text-gray-800",onClick:t[1]||(t[1]=n=>w.value=!0)}," Assign "))]),d("div",Ht,[e(s).data._customActions?(l(),f(x,{key:0,actions:e(s).data._customActions},null,8,["actions"])):b("",!0)])])):b("",!0),e(s).data?(l(),v("div",Pt,[d("div",Ot,[d("div",qt,[i(e(it),{modelValue:T.value,"onUpdate:modelValue":t[6]||(t[6]=n=>T.value=n),tabs:W},{default:r(()=>[i(e(et)),i(e(at),{class:"h-full"},{default:r(({tab:n})=>{var L;return[n.name==="details"?(l(),v("div",Jt,[i(m,{contact:e(s).data.contact,"onEmail:open":t[2]||(t[2]=V=>h.value.toggleEmailBox())},null,8,["contact"]),e(s).data.feedback_rating?(l(),f(a,{key:0,class:"border-b px-6 py-3 text-base text-gray-600",ticket:e(s).data},null,8,["ticket"])):b("",!0),t[15]||(t[15]=d("h3",{class:"px-6 pt-3 font-semibold text-base"},"SLA",-1)),i(st,{ticket:e(s).data},null,8,["ticket"]),t[16]||(t[16]=d("h3",{class:"px-6 pt-3 font-semibold text-base"},"Details",-1)),i(ot,{ticket:e(s).data,onUpdate:t[3]||(t[3]=({field:V,value:Y})=>C(V,Y)),class:"!border-0"},null,8,["ticket"])])):(l(),f(e(nt),{key:1,ref_key:"ticketAgentActivitiesRef",ref:M,activities:X(n.name),title:n.label,"ticket-status":(L=e(s).data)==null?void 0:L.status,onUpdate:t[4]||(t[4]=()=>{e(s).reload()}),"onEmail:reply":t[5]||(t[5]=V=>{h.value.replyToEmail(V)})},null,8,["activities","title","ticket-status"]))]}),_:1})]),_:1},8,["modelValue"]),(l(),f(e(lt),{class:"sticky bottom-0 z-50 bg-white",ref_key:"communicationAreaRef",ref:h,modelValue:e(s).data,"onUpdate:modelValue":t[7]||(t[7]=n=>e(s).data=n),"to-emails":[e(s).data.raised_by],"cc-emails":[],"bcc-emails":[],key:(k=e(s).data)==null?void 0:k.name,onUpdate:t[8]||(t[8]=()=>{e(s).reload(),T.value!==0&&M.value.scrollToLatestActivity()})},null,8,["modelValue","to-emails"]))])])])):b("",!0),e(s).data?(l(),f(e(rt),{key:3,modelValue:w.value,"onUpdate:modelValue":t[9]||(t[9]=n=>w.value=n),assignees:e(s).data.assignees,docname:I.ticketId,team:(E=e(s).data)==null?void 0:E.agent_group,doctype:"HD Ticket",onUpdate:t[10]||(t[10]=()=>{e(s).reload()})},null,8,["modelValue","assignees","docname","team"])):b("",!0),i(e(Ct),{modelValue:$.value,"onUpdate:modelValue":t[14]||(t[14]=n=>$.value=n)},{"body-title":r(()=>[...t[17]||(t[17]=[d("h3",null,"Rename",-1)])]),"body-content":r(()=>[i(e($t),{modelValue:y.value,"onUpdate:modelValue":t[11]||(t[11]=n=>y.value=n),type:"text",size:"sm",variant:"subtle",disabled:!1,label:"New Subject"},null,8,["modelValue"])]),actions:r(()=>[i(u,{variant:"solid",disabled:!y.value,loading:S.value,onClick:t[12]||(t[12]=()=>{C("subject",y.value),$.value=!1})},{default:r(()=>[...t[18]||(t[18]=[F(" Confirm ",-1)])]),_:1},8,["disabled","loading"]),i(u,{class:"ml-2",onClick:t[13]||(t[13]=n=>$.value=!1)},{default:r(()=>[...t[19]||(t[19]=[F(" Close ",-1)])]),_:1})]),_:1},8,["modelValue"])])}}});export{ve as default};
//# sourceMappingURL=MobileTicketAgent-85f1faca.js.map
